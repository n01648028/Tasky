<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<head>
    <title>Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <style>
        .calendar-container {
            margin-top: 2rem;
        }
        #calendar {
            background-color: var(--bs-secondary-bg);
            border-radius: 12px;
            padding: 1rem;
        }
        .fc-toolbar-title {
            color: var(--bs-body-color);
        }
        .fc-col-header-cell-cushion {
            color: var(--bs-body-color);
        }
        .fc-daygrid-day-number {
            color: var(--bs-body-color);
        }
        .fc-event-title {
            color: white;
        }
    </style>
</head>
<body>
<section>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Calendar</h1>
        <a th:href="@{/tasks/new}" class="btn btn-primary">
            <i class="mdi mdi-plus me-1"></i> New Task
        </a>
    </div>
    
    <div class="calendar-container">
        <div id="calendar"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const calendarEl = document.getElementById('calendar');
            
            // Fetch tasks from API
            let tasks = [];
            try {
                const response = await fetch('/api/tasks', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                tasks = await response.json();
            } catch (error) {
                console.error('Error fetching tasks:', error);
            }
            
            // Format tasks for FullCalendar
            const events = tasks.map(task => ({
                title: task.title,
                start: task.dueDate,
                extendedProps: {
                    description: task.description,
                    priority: task.priority
                },
                color: task.priority === 'HIGH' ? '#ef4444' : 
                       task.priority === 'MEDIUM' ? '#f59e0b' : '#10b981'
            }));
            
            // Initialize calendar
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: events,
                eventClick: function(info) {
                    alert(
                        'Task: ' + info.event.title + '\n' +
                        'Description: ' + info.event.extendedProps.description + '\n' +
                        'Priority: ' + info.event.extendedProps.priority
                    );
                }
            });
            
            calendar.render();
        });
    </script>
</section>
</body>
</html>